<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="赚钱助手">
    <title>赚钱软件管理系统</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-title">赚钱软件管理系统</div>
    </nav>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 仪表盘页面 -->
        <div class="page active" id="page-dashboard">
            <div class="date-container">
                <span class="current-date" id="current-date"></span>
            </div>

            <!-- 全局搜索 -->
            <div class="card mb-4">
                <div class="search-container" style="display: flex; gap: 12px; align-items: center;">
                    <div class="search-input-wrapper" style="flex: 1; position: relative;">
                        <input type="text" id="global-search" class="form-input" placeholder="🔍 搜索手机、软件..." oninput="performSearch(this.value)">
                        <div id="search-results" class="search-results-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-md); margin-top: 8px; max-height: 300px; overflow-y: auto; z-index: 100; box-shadow: var(--shadow-card);"></div>
                    </div>
                    <button class="btn btn-secondary" onclick="clearSearch()">清除</button>
                </div>
            </div>

            <!-- 统计卡片 -->
            <div class="stats-container">
                <div class="stats-row">
                    <div class="stat-card border-primary animate-border">
                        <i></i><i></i>
                        <span class="stat-label">总手机数</span>
                        <span class="stat-value" id="total-phones">0</span>
                    </div>
                    <div class="stat-card border-secondary animate-border">
                        <i></i><i></i>
                        <span class="stat-label">总软件数</span>
                        <span class="stat-value" id="total-apps">0</span>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat-card border-tertiary animate-border">
                        <i></i><i></i>
                        <span class="stat-label">剩余支出</span>
                        <span class="stat-value" id="total-balance">¥0.00</span>
                    </div>
                    <div class="stat-card border-accent animate-border">
                        <i></i><i></i>
                        <span class="stat-label">有提现软件</span>
                        <span class="stat-value" id="ready-apps">0</span>
                    </div>
                </div>
            </div>

            <!-- 智能提现建议 -->
            <div class="card mt-4" id="smart-suggestions-card" style="display: none;">
                <div class="section-header">
                    <div class="section-title">💡 智能提现建议</div>
                    <div class="section-divider"></div>
                </div>
                <div id="smart-suggestions-content">
                    <!-- 建议内容将由JS生成 -->
                </div>
            </div>

            <!-- 提现预测 -->
            <div class="card mt-4" id="income-prediction-card" style="display: none;">
                <div class="section-header">
                    <div class="section-title">📊 提现预测</div>
                    <div class="section-divider"></div>
                </div>
                <div id="income-prediction-content">
                    <!-- 预测内容将由JS生成 -->
                </div>
            </div>

            <!-- 软件提现排行 -->
            <div class="card mt-4" id="app-ranking-card" style="display: none;">
                <div class="section-header">
                    <div class="section-title">🏆 软件提现排行</div>
                    <div class="section-divider"></div>
                </div>
                <div id="app-ranking-content">
                    <!-- 排行内容将由JS生成 -->
                </div>
            </div>

            <!-- 提现趋势图表 -->
            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">📈 提现趋势</div>
                    <div class="section-divider"></div>
                </div>
                <div style="margin-bottom: 16px;">
                    <canvas id="incomeChart" style="max-height: 300px;"></canvas>
                </div>
                <div class="flex gap-4 justify-center">
                    <button class="btn btn-secondary" onclick="updateChartPeriod('week')">近7天</button>
                    <button class="btn btn-secondary" onclick="updateChartPeriod('month')">近30天</button>
                    <button class="btn btn-secondary" onclick="updateChartPeriod('year')">全年</button>
                </div>
            </div>

            <!-- 提现日历 -->
            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">📅 提现日历</div>
                    <div class="section-divider"></div>
                </div>
                <div class="calendar-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <button class="btn btn-secondary" onclick="changeCalendarMonth(-1)">◀</button>
                    <span id="calendar-month-year" style="font-weight: 600; font-size: 18px;"></span>
                    <button class="btn btn-secondary" onclick="changeCalendarMonth(1)">▶</button>
                </div>
                <div class="calendar-grid" id="income-calendar" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                    <!-- 日历将由JS生成 -->
                </div>
                <div class="calendar-legend" style="margin-top: 16px; display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 16px; height: 16px; background: #dcfce7; border-radius: 4px;"></div><span style="font-size: 12px;">有提现</span></div>
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 16px; height: 16px; background: #fee2e2; border-radius: 4px;"></div><span style="font-size: 12px;">有支出</span></div>
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 16px; height: 16px; background: #fef3c7; border-radius: 4px;"></div><span style="font-size: 12px;">还款日</span></div>
                </div>
            </div>

            <!-- 今日需要关注的软件 -->
            <div class="section-title">今日需要关注的软件</div>
            <div class="app-list" id="today-apps-list">
                <!-- 空状态将由JS动态生成 -->
            </div>
        </div>

        <!-- 手机管理页面 -->
        <div class="page" id="page-phones">
            <div class="date-container">
                <span class="current-date" id="phones-current-date"></span>
            </div>

            <div class="flex gap-4 w-full">
                <button class="btn btn-primary flex-1" onclick="openAddPhoneModal()">添加手机</button>
                <button class="btn btn-secondary flex-1" onclick="showPage('withdraw-records')">提现记录</button>
            </div>

            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">📱 手机抽签</div>
                    <div class="section-divider"></div>
                </div>
                <div class="form-hint mb-4">随机抽取手机决定玩机顺序，并展示每台手机中软件的玩机顺序</div>
                <div class="flex gap-4">
                    <button class="btn btn-accent flex-1" onclick="startPhoneDraw()">开始手机抽签</button>
                    <button class="btn btn-secondary flex-1" onclick="showPhoneDrawHistory()">抽签历史</button>
                </div>
            </div>

            <div class="phone-grid" id="phone-grid">
                <!-- 空状态将由JS动态生成 -->
            </div>
        </div>

        <!-- 统计分析页面 -->
        <div class="page" id="page-stats">
            <div class="date-container">
                <span class="current-date" id="stats-current-date"></span>
            </div>

            <div class="section-header">
                <div class="section-title">提现与收入统计</div>
                <div class="section-divider"></div>
            </div>

            <div class="stats-grid">
                <div class="stats-row">
                    <div class="stat-card primary animate-border">
                        <i></i><i></i>
                        <span class="stat-label">累计提现</span>
                        <span class="stat-value large" id="stats-total-earned">¥0.00</span>
                    </div>
                    <div class="stat-card secondary animate-border">
                        <i></i><i></i>
                        <span class="stat-label">支出金额</span>
                        <span class="stat-value" id="stats-total-expenses">¥0.00</span>
                    </div>
                    <div class="stat-card tertiary animate-border">
                        <i></i><i></i>
                        <span class="stat-label">剩余支出</span>
                        <span class="stat-value" id="stats-total-balance">¥0.00</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="section-header">
                    <div class="section-title">各软件提现与收入情况</div>
                    <div class="section-divider"></div>
                </div>
                <div class="app-withdraw-list" id="app-withdraw-list">
                    <div class="empty-state">暂无软件数据</div>
                </div>
            </div>
        </div>

        <!-- 游戏管理页面 -->
        <div class="page" id="page-games">
            <div class="date-container">
                <span class="current-date" id="games-current-date"></span>
            </div>

            <!-- 今日游戏抽签 -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="section-header">
                    <div class="section-title" style="color: white;">🎲 今日游戏抽签</div>
                    <div class="section-divider" style="background: rgba(255,255,255,0.3);"></div>
                </div>
                <div id="today-game-result" style="text-align: center; padding: 20px;">
                    <div style="font-size: 18px; margin-bottom: 16px;">点击下方按钮抽签决定今天玩哪个游戏</div>
                    <button class="btn" onclick="drawTodayGame()" style="background: white; color: #667eea; font-weight: bold; font-size: 16px;">🎮 开始抽签</button>
                </div>
            </div>

            <!-- 手机选择 -->
            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">📱 选择手机</div>
                    <div class="section-divider"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">当前手机</label>
                    <select id="game-phone-select" class="form-input" onchange="onGamePhoneChange()">
                        <option value="">全部手机</option>
                    </select>
                </div>
            </div>

            <!-- 添加新游戏 -->
            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">➕ 添加新游戏</div>
                    <div class="section-divider"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">游戏名称</label>
                    <input type="text" id="new-game-name" class="form-input" placeholder="输入游戏名称">
                </div>
                <button class="btn btn-primary w-full" onclick="addNewGame()">添加游戏</button>
            </div>

            <!-- 游戏统计 -->
            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">📊 游戏统计</div>
                    <div class="section-divider"></div>
                </div>
                <div id="phone-game-stats">
                    <!-- 动态生成各手机统计 -->
                </div>
            </div>

            <!-- 游戏列表 -->
            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">🎮 游戏列表</div>
                    <div class="section-divider"></div>
                </div>
                <div id="games-list">
                    <div class="empty-state">暂无游戏，请添加新游戏</div>
                </div>
            </div>

            <!-- 抽签历史 -->
            <div class="card mt-4">
                <div class="section-header">
                    <div class="section-title">📜 抽签历史</div>
                    <div class="section-divider"></div>
                </div>
                <div id="game-draw-history">
                    <div class="empty-state">暂无抽签记录</div>
                </div>
            </div>
        </div>

        <!-- 设置页面 -->
        <div class="page" id="page-settings">
            <div class="date-container">
                <span class="current-date" id="settings-current-date"></span>
            </div>

            <div class="card mt-6">
                <div class="section-header">
                    <div class="section-title">主题风格</div>
                    <div class="section-divider"></div>
                </div>
                <div class="form-hint mb-4">选择你喜欢的主题风格，一键切换界面配色</div>
                <div class="theme-selector" id="theme-selector">
                    <div class="theme-item" data-theme="default" onclick="setTheme('default')">
                        <div class="theme-preview theme-preview-default"></div>
                        <span class="theme-name">梦幻紫</span>
                    </div>
                    <div class="theme-item" data-theme="youth-green" onclick="setTheme('youth-green')">
                        <div class="theme-preview theme-preview-youth-green"></div>
                        <span class="theme-name">青春绿</span>
                    </div>
                    <div class="theme-item" data-theme="vitality-orange" onclick="setTheme('vitality-orange')">
                        <div class="theme-preview theme-preview-vitality-orange"></div>
                        <span class="theme-name">活力橙</span>
                    </div>
                    <div class="theme-item" data-theme="ocean-blue" onclick="setTheme('ocean-blue')">
                        <div class="theme-preview theme-preview-ocean-blue"></div>
                        <span class="theme-name">海洋蓝</span>
                    </div>
                    <div class="theme-item" data-theme="sweet-pink" onclick="setTheme('sweet-pink')">
                        <div class="theme-preview theme-preview-sweet-pink"></div>
                        <span class="theme-name">甜美粉</span>
                    </div>
                    <div class="theme-item" data-theme="warm-sunset" onclick="setTheme('warm-sunset')">
                        <div class="theme-preview theme-preview-warm-sunset"></div>
                        <span class="theme-name">温暖夕阳</span>
                    </div>
                    <div class="theme-item" data-theme="minimal-dark" onclick="setTheme('minimal-dark')">
                        <div class="theme-preview theme-preview-minimal-dark"></div>
                        <span class="theme-name">极简黑白</span>
                    </div>
                    <div class="theme-item" data-theme="morandi" onclick="setTheme('morandi')">
                        <div class="theme-preview theme-preview-morandi"></div>
                        <span class="theme-name">莫兰迪色</span>
                    </div>
                    <div class="theme-item" data-theme="forest" onclick="setTheme('forest')">
                        <div class="theme-preview theme-preview-forest"></div>
                        <span class="theme-name">森林自然</span>
                    </div>
                    <div class="theme-item" data-theme="business" onclick="setTheme('business')">
                        <div class="theme-preview theme-preview-business"></div>
                        <span class="theme-name">极简商务风</span>
                    </div>
                    <div class="theme-item" data-theme="dark" onclick="setTheme('dark')">
                        <div class="theme-preview theme-preview-dark"></div>
                        <span class="theme-name">暗黑模式</span>
                    </div>
                </div>
            </div>

                <!-- 支出管理 -->
                <div class="settings-card card mb-4">
                    <div class="settings-card-header">
                        <span class="settings-icon">💰</span>
                        <span class="settings-title">支出管理</span>
                    </div>
                    <div class="form-group mb-2">
                        <label class="form-label" style="font-size: 12px;">待支出余额 (元)</label>
                        <input type="text" id="total-withdrawn" class="form-input" disabled style="font-size: 13px;">
                    </div>
                    <div class="form-group mb-2">
                        <label class="form-label" style="font-size: 12px;">支出金额</label>
                        <input type="number" id="expense-amount" class="form-input" placeholder="输入金额" step="0.01" style="font-size: 13px;">
                    </div>
                    <div class="form-group mb-2">
                        <label class="form-label" style="font-size: 12px;">支出用途</label>
                        <input type="text" id="expense-purpose" class="form-input" placeholder="输入用途" style="font-size: 13px;">
                    </div>
                    <div class="form-group mb-3">
                        <label class="form-label" style="font-size: 12px;">支出日期</label>
                        <input type="date" id="expense-date" class="form-input" style="font-size: 13px;">
                    </div>
                    <div class="flex gap-4">
                        <button class="btn btn-primary flex-1" onclick="addExpense()">💾 保存支出</button>
                        <button class="btn btn-secondary flex-1" onclick="showPage('expense-records')">📋 记录</button>
                    </div>
                </div>

                <!-- 危险操作 -->
                <div class="settings-card card settings-card-danger">
                    <div class="settings-card-header">
                        <span class="settings-icon">⚠️</span>
                        <span class="settings-title" style="color: var(--error-color);">危险操作</span>
                    </div>
                    <div class="form-hint mb-3" style="font-size: 13px; color: var(--error-color);">清空所有数据，此操作不可恢复！</div>
                    <button class="btn btn-error w-full" onclick="clearAllData()">🗑️ 清空所有数据</button>
                </div>
            </div>
        </div>

        <!-- 提现记录页面 -->
        <div class="page" id="page-withdraw-records">
            <div class="page-header">
                <button class="btn btn-secondary" onclick="showPage('phones')">返回</button>
                <div class="section-title">提现记录</div>
            </div>
            <div class="withdraw-records" id="withdraw-records-list">
                <div class="empty-state">暂无提现记录</div>
            </div>
        </div>

        <!-- 支出记录页面 -->
        <div class="page" id="page-expense-records">
            <div class="page-header">
                <button class="btn btn-secondary" onclick="showPage('settings')">返回</button>
                <div class="section-title">支出记录</div>
            </div>
            <div class="expense-records" id="expense-records-list">
                <div class="empty-state">暂无支出记录</div>
            </div>
        </div>

        <!-- 分期还款管理页面 -->
        <div class="page" id="page-installments">
            <div class="date-container">
                <span class="current-date" id="installments-current-date"></span>
            </div>

            <div class="flex gap-4 w-full">
                <button class="btn btn-primary flex-1" onclick="openAddInstallmentModal()">添加分期</button>
                <button class="btn btn-secondary flex-1" onclick="openBatchAddInstallmentModal()">批量添加</button>
                <button class="btn btn-secondary flex-1" onclick="calculateInstallmentGoalsGlobal()">刷新计算</button>
            </div>

            <!-- 分期总览 -->
            <div class="card mt-6">
                <div class="section-header">
                    <div class="section-title">分期还款总览</div>
                    <div class="section-divider"></div>
                </div>
                <div class="stats-container">
                    <div class="stats-row">
                        <div class="stat-card border-primary">
                            <span class="stat-label">总还款金额</span>
                            <span class="stat-value" id="total-installment-amount">¥0.00</span>
                        </div>
                        <div class="stat-card border-secondary">
                            <span class="stat-label">最近还款日期</span>
                            <span class="stat-value" id="nearest-due-date">暂无</span>
                        </div>
                    </div>
                    <div class="stats-row">
                        <div class="stat-card border-tertiary">
                            <span class="stat-label">待还金额</span>
                            <span class="stat-value" id="installment-pending-amount">¥0.00</span>
                        </div>
                        <div class="stat-card border-accent">
                            <span class="stat-label">已还金额</span>
                            <span class="stat-value" id="installment-repaid-amount">¥0.00</span>
                        </div>
                    </div>
                    <div class="stats-row">
                        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <span class="stat-label" style="color: rgba(255,255,255,0.9);">可用资金</span>
                            <span class="stat-value" style="color: white;" id="installment-available-funds">¥0.00</span>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                            <span class="stat-label" style="color: rgba(255,255,255,0.9);">剩余天数</span>
                            <span class="stat-value" style="color: white;" id="installment-days-left">0天</span>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- 分期列表 -->
            <div class="section-title mt-6">分期还款计划</div>
            <div class="installment-list" id="installment-list">
                <div class="empty-state">暂无分期记录</div>
            </div>
        </div>
    </main>

    <!-- 底部导航 -->
    <nav class="tab-bar">
        <div class="tab-item active" data-page="dashboard" onclick="showPage('dashboard')">
            <span class="tab-icon">📊</span>
            <span class="tab-text">仪表盘</span>
        </div>
        <div class="tab-item" data-page="phones" onclick="showPage('phones')">
            <span class="tab-icon">📱</span>
            <span class="tab-text">手机管理</span>
        </div>
        <div class="tab-item" data-page="stats" onclick="showPage('stats')">
            <span class="tab-icon">📈</span>
            <span class="tab-text">统计分析</span>
        </div>
        <div class="tab-item" data-page="installments" onclick="showPage('installments')">
            <span class="tab-icon">💳</span>
            <span class="tab-text">分期还款</span>
        </div>
        <div class="tab-item" data-page="games" onclick="showPage('games')">
            <span class="tab-icon">🎮</span>
            <span class="tab-text">游戏管理</span>
        </div>
        <div class="tab-item" data-page="settings" onclick="showPage('settings')">
            <span class="tab-icon">⚙️</span>
            <span class="tab-text">设置</span>
        </div>
    </nav>

    <!-- 模态框 -->
    <div class="modal" id="modal" style="display: none;">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-title" id="modal-title">标题</div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-buttons" id="modal-buttons"></div>
        </div>
    </div>

    <!-- 游戏抽签弹窗 -->
    <div class="game-draw-modal" id="game-draw-modal" style="display: none;">
        <div class="game-draw-modal-content" onclick="event.stopPropagation()">
            <div class="modal-title">🎮 游戏抽签</div>
            <div class="game-draw-body" id="game-draw-body">
                <!-- 游戏管理区域 -->
                <div class="game-manage-section" id="game-manage-section">
                    <div class="section-subtitle">管理游戏列表</div>
                    <div class="game-list" id="game-list"></div>
                    <div class="game-add-form">
                        <input type="text" id="draw-game-name" class="form-input" placeholder="输入游戏名称">
                        <button class="btn btn-primary" onclick="addGame()">添加游戏</button>
                    </div>
                </div>
                
                <!-- 抽签结果区域 -->
                <div class="game-draw-result-section hidden" id="game-draw-result-section">
                    <div class="draw-result-title">🎯 今日游戏任务</div>
                    <div class="draw-date" id="draw-date"></div>
                    <div class="game-draw-list" id="game-draw-list"></div>
                </div>
                
                <!-- 历史记录区域 -->
                <div class="game-history-section" id="game-history-section">
                    <div class="section-subtitle">📜 历史记录</div>
                    <div class="game-history-list" id="game-history-list"></div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeGameDrawModal()">关闭</button>
                <button class="btn btn-primary" id="game-draw-btn" onclick="startGameDraw()">开始抽签</button>
            </div>
        </div>
    </div>

    <!-- 抽签结果弹窗 -->
    <div class="game-result-popup" id="game-result-popup" style="display: none;">
        <div class="game-result-popup-content" onclick="event.stopPropagation()">
            <div class="game-result-header">
                <div class="game-result-title">🎮 今日游戏任务</div>
                <div class="game-result-date" id="popup-draw-date"></div>
            </div>
            <div class="game-result-body" id="popup-game-result-list"></div>
            <div class="game-result-footer">
                <button class="btn btn-secondary" onclick="closeGameResultPopup()">关闭</button>
                <button class="btn btn-primary" onclick="startGameDraw()">重新抽签</button>
            </div>
        </div>
    </div>

    <!-- 手机抽签弹窗 -->
    <div class="game-draw-modal" id="phone-draw-modal" style="display: none;">
        <div class="game-draw-modal-content" onclick="event.stopPropagation()">
            <div class="modal-title">📱 手机抽签</div>
            <div class="game-draw-body" id="phone-draw-body">
                <!-- 手机抽签结果区域 -->
                <div class="game-draw-result-section" id="phone-draw-result-section">
                    <div class="draw-result-title">🎯 今日玩机顺序</div>
                    <div class="draw-date" id="phone-draw-date"></div>
                    <div class="game-draw-list" id="phone-draw-list"></div>
                </div>
                
                <!-- 历史记录区域 -->
                <div class="game-history-section" id="phone-draw-history-section">
                    <div class="section-subtitle">📜 抽签历史</div>
                    <div class="game-history-list" id="phone-draw-history-list"></div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closePhoneDrawModal()">关闭</button>
                <button class="btn btn-primary" id="phone-draw-btn" onclick="startPhoneDraw()">开始抽签</button>
            </div>
        </div>
    </div>

    <!-- 提示消息 -->
    <div class="toast" id="toast" style="display: none;"></div>

    <script src="app.js"></script>
</body>
</html>
